<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rececoin</title>
</head>

<body>
  <h2>Rececoin â€” Login / Register</h2>
  
  <div>
    <input id="email" type="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />
  </div>
  
  <div>
    <button id="btnRegister">Register</button>
    <button id="btnLogin">Login</button>
    <button id="btnLogout" style="display:none">Logout</button>
  </div>
  

<script type="module">
  // ----- IMPORT FIREBASE (VERSI SAMA) -----
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

  import {
    getFirestore,
    doc,
    setDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

  // ----- CONFIG -----
  const firebaseConfig = {
    apiKey: "AIzaSyBfbW0F9qYu7SdIT2cG7IGOZcB3wsuskk8",
    authDomain: "rececoin-76b27.firebaseapp.com",
    projectId: "rececoin-76b27",
    storageBucket: "rececoin-76b27.firebasestorage.app",
    messagingSenderId: "173498076766",
    appId: "1:173498076766:web:f757e9fa76e93b8727aecf"
  };

  // ----- INIT -----
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ----- ELEM -----
  const emailEl = document.getElementById("email");
  const passEl = document.getElementById("password");
  const btnRegister = document.getElementById("btnRegister");
  const btnLogin = document.getElementById("btnLogin");
  const btnLogout = document.getElementById("btnLogout");

  // REGISTER
  btnRegister.addEventListener("click", async () => {
    const email = emailEl.value;
    const password = passEl.value;

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const uid = userCredential.user.uid;

      // Buat data user di Firestore
      await setDoc(doc(db, "users", uid), {
        coins: 0,
        createdAt: serverTimestamp()
      });

      alert("Registrasi berhasil!");
    } catch (error) {
      alert(error.message);
    }
  });

  // LOGIN
  btnLogin.addEventListener("click", async () => {
    const email = emailEl.value.trim();
    const pass = passEl.value;
    if (!email || !pass) return alert("Isi email & password.");

    try {
      await signInWithEmailAndPassword(auth, email, pass);
      location.href = "/dashboard.html";
    } catch (err) {
      alert("Gagal login: " + err.message);
    }
  });

  // LOGOUT
  btnLogout.addEventListener("click", async () => {
    try {
      await signOut(auth);
      alert("Logout berhasil");
      location.href = "/login-singup.html";
    } catch (err) {
      alert("Gagal logout: " + err.message);
    }
  });

  // UI Otomatis
  onAuthStateChanged(auth, (user) => {
    if (user) {
      btnLogout.style.display = "inline";
      btnLogin.style.display = "none";
      btnRegister.style.display = "none";
      location.href = "/dashboard.html";
      
    } else {
      btnLogout.style.display = "none";
      btnLogin.style.display = "inline";
      btnRegister.style.display = "inline";
    }
  });

  window.rececoin = { app, auth };
</script>


</body>

</html>